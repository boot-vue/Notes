(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{369:function(t,s,a){t.exports=a.p+"assets/img/sproxy.ac83c703.png"},415:function(t,s,a){"use strict";a.r(s);var n=a(12),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"mysql-☢️"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-☢️"}},[t._v("#")]),t._v(" MySQL ☢️")]),t._v(" "),n("h2",{attrs:{id:"主从同步"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主从同步"}},[t._v("#")]),t._v(" 主从同步")]),t._v(" "),n("p",[t._v("主节点:")]),t._v(" "),n("p",[t._v("配置文件:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("server_id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  唯一\nlog-bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mysql-log\nexpire_logs_days "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("\nbinlog-ignore-db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mysql  忽略同步\nbinlog-ignore-db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("test\n\nbinlog-do-db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx  要同步的数据库\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("binlog_format")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("STATEMENT  binlog格式\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gtid_mode")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ON\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("enforce_gtid_consistency")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ON\n")])])]),n("p",[t._v("statement :记录写操作\nrow: 记录每一行数据变化\nmixed: 自动选择")]),t._v(" "),n("blockquote",[n("p",[t._v("创建一个用户, 赋予 replaction slave 权限")])]),t._v(" "),n("blockquote",[n("p",[t._v("CHANGE MASTER TO MASTER_DELAY = 1800；单位为秒 延迟从库同步时间")])]),t._v(" "),n("blockquote",[n("p",[t._v("show master status;")])]),t._v(" "),n("p",[t._v("从节点:")]),t._v(" "),n("p",[t._v("配置文件")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("server-id"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\nrelay-log"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mysql-relay\nlog-bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\nbinlog-format"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ROW\n\nreplicate-do-db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx  可以不指定\nreplicate-do-db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n\nreplicate-ignore-db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gtid_mode")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ON\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("enforce_gtid_consistency")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ON\n\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CHANGE MASTER TO MASTER_HOST "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.*.*.36'")]),t._v(", MASTER_USER "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repl'")]),t._v(", MASTER_PASSWORD "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'replpassword'")]),t._v(", MASTER_PORT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(", MASTER_AUTO_POSITION "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", MASTER_RETRY_COUNT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(", MASTER_HEARTBEAT_PERIOD "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# master  用户密码 时  caching_sha2_password 策略的话  必须设置一个安全连接用户(要配置公钥私钥)")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者")]),t._v("\n\nCHANGE MASTER TO "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("master_host")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.49.80'")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("master_port")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30002")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("master_auto_position")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#需要开启gtid 并且不能与 master_log_file master_log_pos同时使用")]),t._v("\nSTART SLAVE "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mmss'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DEFAULT_AUTH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql_native_password'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据同步不一致")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清掉slave  导入数据后  继续开启同步")]),t._v("\n")])])]),n("blockquote",[n("p",[t._v("stop slave;")])]),t._v(" "),n("blockquote",[n("p",[t._v("reset master; reset slave;")])]),t._v(" "),n("blockquote",[n("p",[t._v("show slave status;")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CHANGE MASTER TO option "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(", option"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" channel_option "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\noption: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    MASTER_BIND "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'interface_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_HOST "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'host_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_USER "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_PASSWORD "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'password'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_PORT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" port_num\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" PRIVILEGE_CHECKS_USER "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'account'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" REQUIRE_ROW_FORMAT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" REQUIRE_TABLE_PRIMARY_KEY_CHECK "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("STREAM "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ON "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" OFF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_CONNECT_RETRY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" interval\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_RETRY_COUNT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" count\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_DELAY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" interval\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_HEARTBEAT_PERIOD "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" interval\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_LOG_FILE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'source_log_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_LOG_POS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" source_log_pos\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_AUTO_POSITION "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" RELAY_LOG_FILE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'relay_log_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" RELAY_LOG_POS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" relay_log_pos\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_COMPRESSION_ALGORITHMS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'value'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_ZSTD_COMPRESSION_LEVEL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" level\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL_CA "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ca_file_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL_CAPATH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ca_directory_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL_CERT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cert_file_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL_CRL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'crl_file_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL_CRLPATH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'crl_directory_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL_KEY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'key_file_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL_CIPHER "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cipher_list'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_SSL_VERIFY_SERVER_CERT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_TLS_VERSION "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'protocol_list'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_TLS_CIPHERSUITES "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ciphersuite_list'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MASTER_PUBLIC_KEY_PATH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'key_file_name'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" GET_MASTER_PUBLIC_KEY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" IGNORE_SERVER_IDS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("server_id_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nchannel_option:\n    FOR CHANNEL channel\n\nserver_id_list:\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("server_id "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(", server_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("START SLAVE "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("thread_types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("until_option"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("connection_options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("channel_option"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nthread_types:\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("thread_type "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(", thread_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nthread_type:\n    IO_THREAD "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SQL_THREAD\n\nuntil_option:\n    UNTIL "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SQL_BEFORE_GTIDS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SQL_AFTER_GTIDS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gtid_set\n          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   MASTER_LOG_FILE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'log_name'")]),t._v(", MASTER_LOG_POS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" log_pos\n          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   RELAY_LOG_FILE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'log_name'")]),t._v(", RELAY_LOG_POS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" log_pos\n          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   SQL_AFTER_MTS_GAPS  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nconnection_options:\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user_name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("PASSWORD"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user_pass'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("DEFAULT_AUTH"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'plugin_name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("PLUGIN_DIR"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'plugin_dir'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n\nchannel_option:\n    FOR CHANNEL channel\n\ngtid_set:\n    uuid_set "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(", uuid_set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n\nuuid_set:\n    uuid:interval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":interval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nuuid:\n    hhhhhhhh-hhhh-hhhh-hhhh-hhhhhhhhhhhh\n\nh:\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("-9,A-F"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ninterval:\n    n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"mysql-分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-分区"}},[t._v("#")]),t._v(" MySQL 分区")]),t._v(" "),n("ol",[n("li",[t._v("range: 给定一个连续区间的范围值进行分区")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 语法")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 字段")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("MyISAM  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" range "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("分区字段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than maxvalue\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[t._v("list: 设置若干个固定值进行分区，如果某个字段的值在这个设置的值列表中就会被分配到该分区")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 语法")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 字段")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("数据库引擎  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" LIST "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("分区字段或者基于该字段的返回的整数值的表达式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Value1，Value2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Value3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Value4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Value5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[t._v("columns 分区: columns 分区分为 range columns 和 list columns 两种，支持整数(tinyint 到 bigint， 不支持 decimal 和 float)、日期(date、datetime)、字符串(char、varchar、binary、varbinary)三大数据类型")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" range "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("columns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p01 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p02 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p04 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p05 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" maxvalue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p06 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("maxvalue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" maxvalue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"4"}},[n("li",[t._v("hash 分区: 对分区键应用一个散列函数，以此确定数据应当放在 N 个分区中的哪个分区")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- HASH")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 字段")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("innodb")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PARTITION")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("HASH")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nPARTITIONS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("num"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"5"}},[n("li",[t._v("key 分区: key 分区不允许使用用于自定义的表达式，需要使用 mysql 服务器提供的 hash 函数，同时 hash 分区只支持整数分区，而 key 分区支持使用 blob or text 类型外的其他类型的列作为分区键")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" partitions num"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 不指定默认首选主键作为分区键，在没有主键的情况下会选择非空唯一键作为分区键")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" partitions num"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- linear key")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" linear "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"pxc-同步"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pxc-同步"}},[t._v("#")]),t._v(" PXC 同步")]),t._v(" "),n("p",[t._v("pecona 只支持 innodb 引擎 数据强一致性 实时同步数据")]),t._v(" "),n("p",[t._v("pxc 集群启动时 要从最后一个退出的节点启动, 最后退出的节点会被标记为主节点, "),n("code",[t._v("grastate.dat")]),t._v(" 文件 safe_to_bootstrap=1 表示这个节点是最后退出的节点, 要作为主节点启动 文件位置在 mysql data 目录")]),t._v(" "),n("blockquote",[n("p",[t._v("pxc 5.7.21 ,高版本有问题,待研究")])]),t._v(" "),n("p",[t._v("主节点容器:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("docker run -d -p xxx:3306 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("master "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v xxx:/var/lib/mysql --privileged "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxxx pxc\n")])])]),n("p",[t._v("从节点容器:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("docker run -d -p xxx:3306 -e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("master "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTARBACKUP_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v xxx:/var/lib/mysql --privileged "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node2 --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx pxc\n")])])]),n("p",[t._v("数据分片, 数据切分到不同的 pxc 集群上")]),t._v(" "),n("h2",{attrs:{id:"mycat"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mycat"}},[t._v("#")]),t._v(" MyCat")]),t._v(" "),n("blockquote",[n("p",[t._v("听说 2.0 用 yml?")])]),t._v(" "),n("p",[n("code",[t._v("server.xml")]),t._v("\n配置 mycat 虚拟用户与数据库, 可以配置多个")]),t._v(" "),n("p",[t._v("pxc 只需要负载均衡 replication 需要读写分离")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("mycat:")]),t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("user")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("admin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("defaultAccount")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("admin"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("schemas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("mycat"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("mycat:")]),t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[n("code",[t._v("schema.xml")])]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dataHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("mycat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("maxCon")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("minCon")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("balance")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("writeType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbDriver")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("native"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("switchType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("slaveThreshold")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("heartbeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("select 1"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("heartbeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--节点--\x3e")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("writeHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("xx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("xxx:3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--readHost balance需要为3--\x3e")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("writeHost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dataHost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[n("code",[t._v("dataNode")]),t._v(" 指定 mycat 使用的数据库")]),t._v(" "),n("p",[n("code",[t._v("schema")]),t._v(" 指定虚拟库, "),n("code",[t._v("table")]),t._v(" 指定切分的表")]),t._v(" "),n("p",[n("code",[t._v("rule.xml")])]),t._v(" "),n("p",[t._v("分片规则")]),t._v(" "),n("h2",{attrs:{id:"percona"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#percona"}},[t._v("#")]),t._v(" Percona")]),t._v(" "),n("h3",{attrs:{id:"xtrabackup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#xtrabackup"}},[t._v("#")]),t._v(" XtraBackup")]),t._v(" "),n("h2",{attrs:{id:"shardingsphere"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#shardingsphere"}},[t._v("#")]),t._v(" ShardingSphere")]),t._v(" "),n("ol",[n("li",[t._v("数据分片")])]),t._v(" "),n("blockquote",[n("p",[t._v("配置对照 sharding-jdbc 看 , 官方文档写的和屎一样")])]),t._v(" "),n("blockquote",[n("p",[t._v("sql 语句兼容性差,一些特殊字段 需要特别注意")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schemaName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sharding_db\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataSources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ds0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jdbc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("30002/ds\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connectionTimeoutMilliseconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("idleTimeoutMilliseconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxLifetimeMilliseconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1800000")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxPoolSize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ds1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jdbc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("30008/ds\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connectionTimeoutMilliseconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("idleTimeoutMilliseconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxLifetimeMilliseconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1800000")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxPoolSize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shardingRule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("t_order")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("actualDataNodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ds$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("0..1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(".t_order$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("0..1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("databaseStrategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("inline")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shardingColumn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user_id\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("algorithmExpression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ds$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_id % 2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tableStrategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("inline")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shardingColumn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" order_id\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("algorithmExpression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" t_order$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("order_id % 2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keyGenerator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以不配置")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SNOWFLAKE\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("column")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" order_id\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("t_order_item")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("actualDataNodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ds$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("0..1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(".t_order_item$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("0..1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("databaseStrategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("inline")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shardingColumn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user_id\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("algorithmExpression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ds$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_id % 2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tableStrategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("inline")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shardingColumn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" order_id\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("algorithmExpression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" t_order_item$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("order_id % 2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keyGenerator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SNOWFLAKE\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("column")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" order_item_id\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindingTables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" t_order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("t_order_item\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultDataSourceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ds0 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  默认数据源 不分片  只能指定一个  没有指定其它规则的表都写到这一个节点")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("broadcastTables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  广播表    所有节点都会同步写入   查询的时候从一个节点查")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" user\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultTableStrategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("none")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(369),alt:"示例"}})]),t._v(" "),n("h2",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),n("blockquote",[n("p",[t._v("查看 mysql 文档, 区分 命令行配置 系统变量 配置文件...., 可配置项不完全相同")])]),t._v(" "),n("blockquote",[n("p",[t._v("验证配置: mysqld --validate-config")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\npid-file\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /var/run/mysqld/mysqld.pid\nsocket\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /var/run/mysqld/mysqld.sock\ndatadir\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /var/lib/mysql\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#log-error\t= /var/log/mysql/error.log")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# By default we only accept connections from localhost")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#bind-address\t= 127.0.0.1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Disabling symbolic-links is recommended to prevent assorted security risks")]),t._v("\nsymbolic-links"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("character_set_server")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("collation_server")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_0900_ai_ci\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("max_connections")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\ndefault-time-zone"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'+8:00'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("slow_query_log")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ON\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("long_query_time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认10s")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ndefault-character-set"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4\n\n")])])]),n("h2",{attrs:{id:"存储过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#存储过程"}},[t._v("#")]),t._v(" 存储过程")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CREATE "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DEFINER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("root"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("@"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("localhost"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" PROCEDURE "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nBEGIN\n\tSELECT * from student"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nEND\n")])])]),n("p",[t._v("调用:")]),t._v(" "),n("blockquote",[n("p",[t._v("call test();")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("变量")]),t._v(" "),n("blockquote",[n("p",[t._v("DECLARE x, y INT DEFAULT 0; "),n("code",[t._v("声明")]),t._v("\nSET x=10; "),n("code",[t._v("赋值")]),t._v("\nselect ... INTO y from....; "),n("code",[t._v("赋值")])])])]),t._v(" "),n("li",[n("p",[t._v("参数")]),t._v(" "),n("blockquote",[n("p",[n("code",[t._v("IN OUT INOUT")])])])])]),t._v(" "),n("ol",[n("li",[n("code",[t._v("IN")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CREATE PROCEDURE xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN zz VARCHAR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n调用的时候: call xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[n("code",[t._v("OUT")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CREATE PROCEDURE xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n IN x VARCHAR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n OUT y INT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n 调用: call xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试"')]),t._v(",@oo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" @oo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  //@"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". 局部变量\n")])])]),n("ul",[n("li",[t._v("流程控制")])]),t._v(" "),n("ol",[n("li",[n("code",[t._v("IF")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("IF expression THEN\n   statements"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEND IF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[n("code",[t._v("CASE")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CASE  case_expression\n   WHEN when_expression_1 THEN commands\n   WHEN when_expression_2 THEN commands\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n   ELSE commands\nEND CASE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[n("code",[t._v("while")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("WHILE expression DO\n   statements\nEND WHILE\n")])])]),n("ol",{attrs:{start:"4"}},[n("li",[n("code",[t._v("repeat")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("REPEAT\n statements"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nUNTIL expression\nEND REPEAT\n")])])]),n("ol",{attrs:{start:"5"}},[n("li",[n("code",[t._v("loop")]),t._v(" "),n("blockquote",[n("p",[t._v("leave :跳出循环\niterate: 继续下一次循环,类似 continue")])])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("xxx: LOOP\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nend xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[n("code",[t._v("游标")]),t._v(" "),n("blockquote",[n("p",[t._v("声明: DECLARE cursor_name CURSOR FOR SELECT_statement;\nOPEN 语句初始化游标的结果集: open cursor_name;\nFETCH 检索游标下一行: FETCH cursor_name INTO variables;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET finished = 1; //游标结束\n完整声明:")])])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("DECLARE finished INTEGER DEFAULT "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDECLARE email varchar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" DEFAULT "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nDEClARE email_cursor CURSOR FOR SELECT email FROM employees"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET finished "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("遍历游标:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("OPEN email_cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nget_email: LOOP\nFETCH email_cursor INTO v_email"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nIF finished "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" THEN\nLEAVE get_email"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEND IF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSET email_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CONCAT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v_email,"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('";"')]),t._v(",email_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEND LOOP get_email"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nCLOSE email_cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("异常处理")])]),t._v(" "),n("ol",[n("li",[n("code",[t._v("signal/resignal")]),t._v(" "),n("blockquote",[n("p",[t._v("相当于直接抛出 sql 异常")])])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("IF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("C "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" THEN\n SIGNAL SQLSTATE "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'45000'")]),t._v(" //只能使用sqlstate的值\n SET MESSAGE_TEXT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'......'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" //只能是MESSAGE_TEXT，MYSQL_ERRORNO，CURSOR_NAME\n END IF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[n("code",[t._v("handler")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("DECLARE handler_action HANDLER\n    FOR condition_value "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(", condition_value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n    statement\n\nhandler_action:\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CONTINUE\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" EXIT\n\ncondition_value:\n    mysql_error_code\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SQLSTATE "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("VALUE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" sqlstate_value\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" condition_name\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SQLWARNING\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" NOT FOUND\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SQLEXCEPTION\n")])])]),n("h3",{attrs:{id:"存储函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#存储函数"}},[t._v("#")]),t._v(" 存储函数")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CREATE FUNCTION function_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param1,param2,…"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    RETURNS datatype\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NOT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" DETERMINISTIC\n statements\n")])])]),n("blockquote",[n("p",[t._v("必须有 returns, 仅返回一个值")])]),t._v(" "),n("h3",{attrs:{id:"触发器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#触发器"}},[t._v("#")]),t._v(" 触发器")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CREATE TRIGGER trigger_name trigger_time trigger_event ON tb_name FOR EACH ROW trigger_stmt\ntrigger_name：触发器的名称\ntirgger_time：触发时机，为BEFORE或者AFTER\ntrigger_event：触发事件，为INSERT、DELETE或者UPDATE\ntb_name：表示建立触发器的表明，就是在哪张表上建立触发器\ntrigger_stmt：触发器的程序体，可以是一条SQL语句或者是用BEGIN和END包含的多条语句\n所以可以说MySQL创建以下六种触发器：\nBEFORE INSERT,BEFORE DELETE,BEFORE UPDATE\nAFTER INSERT,AFTER DELETE,AFTER UPDATE\n")])])]),n("h3",{attrs:{id:"event-事件处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#event-事件处理"}},[t._v("#")]),t._v(" event 事件处理")]),t._v(" "),n("blockquote",[n("p",[t._v("mysql 默认关闭了事件执行, 配合文件里记得开启 event_scheduler = 1 #或者 ON")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CREATE\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("DEFINER "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CURRENT_USER "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    EVENT\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IF NOT EXISTS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    event_name\n    ON SCHEDULE schedule\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ON COMPLETION "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NOT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PRESERVE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ENABLE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DISABLE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DISABLE ON SLAVE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("COMMENT "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'comment'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    DO event_body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nschedule:\n    AT timestamp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+ INTERVAL interval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" EVERY interval\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("STARTS timestamp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+ INTERVAL interval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ENDS timestamp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+ INTERVAL interval"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ninterval:\n    quantity "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("YEAR "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" QUARTER "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MONTH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DAY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" HOUR "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MINUTE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n              WEEK "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SECOND "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" YEAR_MONTH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DAY_HOUR "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DAY_MINUTE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n              DAY_SECOND "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" HOUR_MINUTE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" HOUR_SECOND "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MINUTE_SECOND"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"mysql-定时备份-邮件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-定时备份-邮件"}},[t._v("#")]),t._v(" mysql 定时备份,邮件")]),t._v(" "),n("blockquote",[n("p",[t._v("mysqldump -uroot -pxxx -RE --databases xxx > dd.sql\n-RE: 导出存储过程和 event")])]),t._v(" "),n("p",[t._v("邮件发送配置:\nsendmail: 要启动服务")]),t._v(" "),n("p",[t._v("/etc/mail.rc")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yourname@your-domain.com\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("smtp")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mail.your-domain.com\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" smtp-auth-user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yourname\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" smtp-auth-password"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yourpasswd\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" smtp-auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("login\n")])])]),n("p",[t._v("mutt /etc/Muttrc:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("use_from")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yes\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("realname")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data@darkstone.cc\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("envelope_from")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yes\n")])])]),n("blockquote",[n("p",[t._v('mutt xxx@cc.com -s "标题" -a 附件')])]),t._v(" "),n("blockquote",[n("p",[t._v('有问题: mail 命令发送小文件可以, 大文件不能当附件. mutt 没成功过\necho "正文内容"|mail -s "标题" -a 附件 xx@cc.com')])])])}),[],!1,null,null,null);s.default=e.exports}}]);