(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{382:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"mysql-☢️"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-☢️"}},[t._v("#")]),t._v(" MySQL ☢️")]),t._v(" "),s("h2",{attrs:{id:"主从同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主从同步"}},[t._v("#")]),t._v(" 主从同步")]),t._v(" "),s("p",[t._v("主节点:")]),t._v(" "),s("p",[t._v("配置文件:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server_id=1  唯一\nlog-bin=mysql-log\nbinlog-ignore-db=mysql  忽略同步\nbinlog-ignore-db=test\n\nbinlog-do-db=xxx  要同步的数据库\n\nbinlog_format=STATEMENT  binlog格式\n")])])]),s("p",[t._v("statement :记录写操作\nrow: 记录每一行数据变化\nmixed: 自动选择")]),t._v(" "),s("blockquote",[s("p",[t._v("创建一个用户, 赋予 replaction slave 权限")])]),t._v(" "),s("blockquote",[s("p",[t._v("CHANGE MASTER TO MASTER_DELAY = 1800；单位为秒 延迟从库同步时间")])]),t._v(" "),s("blockquote",[s("p",[t._v("show master status;")])]),t._v(" "),s("p",[t._v("从节点:")]),t._v(" "),s("p",[t._v("配置文件")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server-id=2\n\n\nrelay-log=mysql-relay\n\nlog-bin=xxx\n\nmaster-hoet=1.1.1.1 主节点\nmaster-user=xxx\nmaster-password=cccc\nmaster-port=3306\n\nreplicate-do-db=xxx  可以不指定\nreplicate-do-db=xxx\n\nreplicate-ignore-db=xxx\n")])])]),s("blockquote",[s("p",[t._v("stop slave;")])]),t._v(" "),s("blockquote",[s("p",[t._v("reset master;")])]),t._v(" "),s("blockquote",[s("p",[t._v("show slave status;")])]),t._v(" "),s("blockquote",[s("p",[t._v("stop slave sql_thread; start slave sql_thread;")])]),t._v(" "),s("h2",{attrs:{id:"mysql-分区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-分区"}},[t._v("#")]),t._v(" MySQL 分区")]),t._v(" "),s("ol",[s("li",[t._v("range: 给定一个连续区间的范围值进行分区")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 语法")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 字段")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("MyISAM  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" range "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("分区字段"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than maxvalue\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("list: 设置若干个固定值进行分区，如果某个字段的值在这个设置的值列表中就会被分配到该分区")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 语法")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 字段")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("数据库引擎  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" LIST "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("分区字段或者基于该字段的返回的整数值的表达式"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Value1，Value2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Value3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("分区名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Value4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Value5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("columns 分区: columns 分区分为 range columns 和 list columns 两种，支持整数(tinyint 到 bigint， 不支持 decimal 和 float)、日期(date、datetime)、字符串(char、varchar、binary、varbinary)三大数据类型")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" range "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("columns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p01 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p02 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p03 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p04 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p05 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" maxvalue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" p06 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" less than "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("maxvalue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" maxvalue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("hash 分区: 对分区键应用一个散列函数，以此确定数据应当放在 N 个分区中的哪个分区")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- HASH")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 字段")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("innodb")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PARTITION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("HASH")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nPARTITIONS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("num"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("key 分区: key 分区不允许使用用于自定义的表达式，需要使用 mysql 服务器提供的 hash 函数，同时 hash 分区只支持整数分区，而 key 分区支持使用 blob or text 类型外的其他类型的列作为分区键")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" partitions num"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 不指定默认首选主键作为分区键，在没有主键的情况下会选择非空唯一键作为分区键")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" partitions num"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- linear key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" linear "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"pxc-同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pxc-同步"}},[t._v("#")]),t._v(" PXC 同步")]),t._v(" "),s("p",[t._v("pecona 只支持 innodb 引擎 数据强一致性 实时同步数据")]),t._v(" "),s("p",[t._v("pxc 集群启动时 要从最后一个退出的节点启动, 最后退出的节点会被标记为主节点, "),s("code",[t._v("grastate.dat")]),t._v(" 文件 safe_to_bootstrap=1 表示这个节点是最后退出的节点, 要作为主节点启动 文件位置在 mysql data 目录")]),t._v(" "),s("blockquote",[s("p",[t._v("pxc 5.7.21 ,高版本有问题,待研究")])]),t._v(" "),s("p",[t._v("主节点容器:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run -d -p xxx:3306 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("master "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v xxx:/var/lib/mysql --privileged "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 --net"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxxx pxc\n")])])]),s("p",[t._v("从节点容器:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run -d -p xxx:3306 -e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("master "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTARBACKUP_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v xxx:/var/lib/mysql --privileged "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node2 --net"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx pxc\n")])])]),s("p",[t._v("数据分片, 数据切分到不同的 pxc 集群上")]),t._v(" "),s("h2",{attrs:{id:"mycat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mycat"}},[t._v("#")]),t._v(" MyCat")]),t._v(" "),s("blockquote",[s("p",[t._v("听说 2.0 用 yml?")])]),t._v(" "),s("p",[s("code",[t._v("server.xml")]),t._v("\n配置 mycat 虚拟用户与数据库, 可以配置多个")]),t._v(" "),s("p",[t._v("pxc 只需要负载均衡 replication 需要读写分离")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("mycat:")]),t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("user")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("defaultAccount")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("schemas"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("mycat"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("mycat:")]),t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[s("code",[t._v("schema.xml")])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dataHost")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("mycat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("maxCon")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("minCon")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("balance")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("writeType")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbType")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbDriver")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("native"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("switchType")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("slaveThreshold")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("heartbeat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("select 1"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("heartbeat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--节点--\x3e")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("writeHost")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("xxx:3306"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--readHost balance需要为3--\x3e")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("writeHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dataHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[s("code",[t._v("dataNode")]),t._v(" 指定 mycat 使用的数据库")]),t._v(" "),s("p",[s("code",[t._v("schema")]),t._v(" 指定虚拟库, "),s("code",[t._v("table")]),t._v(" 指定切分的表")]),t._v(" "),s("p",[s("code",[t._v("rule.xml")])]),t._v(" "),s("p",[t._v("分片规则")]),t._v(" "),s("h2",{attrs:{id:"percona"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#percona"}},[t._v("#")]),t._v(" Percona")]),t._v(" "),s("h3",{attrs:{id:"xtrabackup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xtrabackup"}},[t._v("#")]),t._v(" XtraBackup")]),t._v(" "),s("h2",{attrs:{id:"shardingsphere"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shardingsphere"}},[t._v("#")]),t._v(" ShardingSphere")]),t._v(" "),s("h2",{attrs:{id:"字符集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#字符集"}},[t._v("#")]),t._v(" 字符集")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\npid-file\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /var/run/mysqld/mysqld.pid\nsocket\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /var/run/mysqld/mysqld.sock\ndatadir\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /var/lib/mysql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#log-error\t= /var/log/mysql/error.log")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# By default we only accept connections from localhost")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#bind-address\t= 127.0.0.1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Disabling symbolic-links is recommended to prevent assorted security risks")]),t._v("\nsymbolic-links"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ncharacter-set-server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4\ncollation-server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_general_ci\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("max_connections")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ndefault-character-set"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4\ndefault-collation"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_general_ci\n\n")])])]),s("h2",{attrs:{id:"存储过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存储过程"}},[t._v("#")]),t._v(" 存储过程")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("CREATE "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DEFINER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("root"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("@"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("localhost"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" PROCEDURE "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nBEGIN\n\tSELECT * from student"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nEND\n")])])]),s("p",[t._v("调用:")]),t._v(" "),s("blockquote",[s("p",[t._v("call test();")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("变量")]),t._v(" "),s("blockquote",[s("p",[t._v("DECLARE x, y INT DEFAULT 0; "),s("code",[t._v("声明")]),t._v("\nSET x=10; "),s("code",[t._v("赋值")]),t._v("\nselect ... INTO y from....; "),s("code",[t._v("赋值")])])])]),t._v(" "),s("li",[s("p",[t._v("参数")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("IN OUT INOUT")])])])])]),t._v(" "),s("ol",[s("li",[s("code",[t._v("IN")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("CREATE PROCEDURE xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN zz VARCHAR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n调用的时候: call xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("code",[t._v("OUT")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("CREATE PROCEDURE xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n IN x VARCHAR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n OUT y INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n 调用: call xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试"')]),t._v(",@oo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" @oo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  //@"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". 局部变量\n")])])]),s("ul",[s("li",[t._v("流程控制")])]),t._v(" "),s("ol",[s("li",[s("code",[t._v("IF")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("IF expression THEN\n   statements"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEND IF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("code",[t._v("CASE")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("CASE  case_expression\n   WHEN when_expression_1 THEN commands\n   WHEN when_expression_2 THEN commands\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n   ELSE commands\nEND CASE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("code",[t._v("while")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("WHILE expression DO\n   statements\nEND WHILE\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("code",[t._v("repeat")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("REPEAT\n statements"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nUNTIL expression\nEND REPEAT\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[s("code",[t._v("loop")]),t._v(" "),s("blockquote",[s("p",[t._v("leave :跳出循环\niterate: 继续下一次循环,类似 continue")])])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("xxx: LOOP\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nend xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("游标")]),t._v(" "),s("blockquote",[s("p",[t._v("声明: DECLARE cursor_name CURSOR FOR SELECT_statement;\nOPEN 语句初始化游标的结果集: open cursor_name;\nFETCH 检索游标下一行: FETCH cursor_name INTO variables;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET finished = 1; //游标结束\n完整声明:")])])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("DECLARE finished INTEGER DEFAULT "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDECLARE email varchar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" DEFAULT "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nDEClARE email_cursor CURSOR FOR SELECT email FROM employees"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET finished "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("遍历游标:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("OPEN email_cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nget_email: LOOP\nFETCH email_cursor INTO v_email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nIF finished "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" THEN\nLEAVE get_email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEND IF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSET email_list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CONCAT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v_email,"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('";"')]),t._v(",email_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEND LOOP get_email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nCLOSE email_cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("异常处理")])]),t._v(" "),s("ol",[s("li",[s("code",[t._v("signal/resignal")]),t._v(" "),s("blockquote",[s("p",[t._v("相当于直接抛出 sql 异常")])])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("IF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("C "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" THEN\n SIGNAL SQLSTATE "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'45000'")]),t._v(" //只能使用sqlstate的值\n SET MESSAGE_TEXT "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'......'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" //只能是MESSAGE_TEXT，MYSQL_ERRORNO，CURSOR_NAME\n END IF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("code",[t._v("handler")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("DECLARE handler_action HANDLER\n    FOR condition_value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(", condition_value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n    statement\n\nhandler_action:\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CONTINUE\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" EXIT\n\ncondition_value:\n    mysql_error_code\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SQLSTATE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("VALUE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" sqlstate_value\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" condition_name\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SQLWARNING\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" NOT FOUND\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SQLEXCEPTION\n")])])]),s("h3",{attrs:{id:"存储函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存储函数"}},[t._v("#")]),t._v(" 存储函数")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("CREATE FUNCTION function_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param1,param2,…"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    RETURNS datatype\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NOT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" DETERMINISTIC\n statements\n")])])]),s("blockquote",[s("p",[t._v("必须有 returns, 仅返回一个值")])]),t._v(" "),s("h3",{attrs:{id:"触发器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#触发器"}},[t._v("#")]),t._v(" 触发器")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("CREATE TRIGGER trigger_name trigger_time trigger_event ON tb_name FOR EACH ROW trigger_stmt\ntrigger_name：触发器的名称\ntirgger_time：触发时机，为BEFORE或者AFTER\ntrigger_event：触发事件，为INSERT、DELETE或者UPDATE\ntb_name：表示建立触发器的表明，就是在哪张表上建立触发器\ntrigger_stmt：触发器的程序体，可以是一条SQL语句或者是用BEGIN和END包含的多条语句\n所以可以说MySQL创建以下六种触发器：\nBEFORE INSERT,BEFORE DELETE,BEFORE UPDATE\nAFTER INSERT,AFTER DELETE,AFTER UPDATE\n")])])]),s("h3",{attrs:{id:"event-事件处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#event-事件处理"}},[t._v("#")]),t._v(" event 事件处理")]),t._v(" "),s("blockquote",[s("p",[t._v("mysql 默认关闭了事件执行, 配合文件里记得开启 event_scheduler = 1 #或者 ON")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("CREATE\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("DEFINER "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CURRENT_USER "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    EVENT\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IF NOT EXISTS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    event_name\n    ON SCHEDULE schedule\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ON COMPLETION "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NOT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PRESERVE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ENABLE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DISABLE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DISABLE ON SLAVE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("COMMENT "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'comment'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    DO event_body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nschedule:\n    AT timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+ INTERVAL interval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" EVERY interval\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("STARTS timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+ INTERVAL interval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ENDS timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+ INTERVAL interval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ninterval:\n    quantity "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("YEAR "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" QUARTER "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MONTH "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DAY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" HOUR "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MINUTE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n              WEEK "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SECOND "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" YEAR_MONTH "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DAY_HOUR "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" DAY_MINUTE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n              DAY_SECOND "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" HOUR_MINUTE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" HOUR_SECOND "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" MINUTE_SECOND"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"mysql-定时备份-邮件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-定时备份-邮件"}},[t._v("#")]),t._v(" mysql 定时备份,邮件")]),t._v(" "),s("blockquote",[s("p",[t._v("mysqldump -uroot -pxxx -RE --databases xxx > dd.sql\n-RE: 导出存储过程和 event")])]),t._v(" "),s("p",[t._v("邮件发送配置:\nsendmail: 要启动服务")]),t._v(" "),s("p",[t._v("/etc/mail.rc")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yourname@your-domain.com\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("smtp")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mail.your-domain.com\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" smtp-auth-user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yourname\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" smtp-auth-password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yourpasswd\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" smtp-auth"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("login\n")])])]),s("p",[t._v("mutt /etc/Muttrc:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("use_from")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yes\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("realname")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data@darkstone.cc\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("envelope_from")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yes\n")])])]),s("blockquote",[s("p",[t._v('mutt xxx@cc.com -s "标题" -a 附件')])]),t._v(" "),s("blockquote",[s("p",[t._v('有问题: mail 命令发送小文件可以, 大文件不能当附件. mutt 没成功过\necho "正文内容"|mail -s "标题" -a 附件 xx@cc.com')])])])}),[],!1,null,null,null);a.default=e.exports}}]);