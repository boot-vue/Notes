(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{393:function(t,a,s){"use strict";s.r(a);var e=s(12),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"基础概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础概念"}},[t._v("#")]),t._v(" 基础概念")]),t._v(" "),s("ul",[s("li",[t._v("节点（Node）：一个节点是一个运行 Kubernetes 中的主机。")]),t._v(" "),s("li",[t._v("容器组（Pod）：一个 Pod 对应于由若干容器组成的一个容器组，同个组内的容器共享一个存储卷(volume)。")]),t._v(" "),s("li",[t._v("容器组生命周期（pos-states）：包含所有容器状态集合，包括容器组状态类型，容器组生命周期，事件，重启策略，以及 replication controllers。")]),t._v(" "),s("li",[t._v("Replication Controllers：主要负责指定数量的 pod 在同一时间一起运行 废弃")]),t._v(" "),s("li",[t._v("服务（services）：一个 Kubernetes 服务是容器组逻辑的高级抽象，同时也对外提供访问容器组的策略。")]),t._v(" "),s("li",[t._v("卷（volumes）：一个卷就是一个目录，容器对其有访问权限。")]),t._v(" "),s("li",[t._v("标签（labels）：标签是用来连接一组对象的，比如容器组。标签可以被用来组织和选择子对象。")]),t._v(" "),s("li",[t._v("接口权限（accessing_the_api）：端口，IP 地址和代理的防火墙规则。")]),t._v(" "),s("li",[t._v("web 界面（ux）：用户可以通过 web 界面操作 Kubernetes。")]),t._v(" "),s("li",[t._v("命令行操作（cli）：kubectl 命令。")])]),t._v(" "),s("h1",{attrs:{id:"kubeadm-引导集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm-引导集群"}},[t._v("#")]),t._v(" kubeadm 引导集群")]),t._v(" "),s("blockquote",[s("p",[t._v("image registry: "),s("code",[t._v("registry.aliyuncs.com/google_containers")])])]),t._v(" "),s("blockquote",[s("p",[t._v("1master 2 node")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Node")]),t._v(" "),s("th",[t._v("role")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("192.168.100.80")]),t._v(" "),s("td",[t._v("control-plane,master")])]),t._v(" "),s("tr",[s("td",[t._v("192.168.100.81")]),t._v(" "),s("td",[t._v("worker")])]),t._v(" "),s("tr",[s("td",[t._v("192.168.100.82")]),t._v(" "),s("td",[t._v("worker")])])])]),t._v(" "),s("h2",{attrs:{id:"初始化集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化集群"}},[t._v("#")]),t._v(" 初始化集群")]),t._v(" "),s("ol",[s("li",[t._v("安装"),s("code",[t._v("kubeadm")]),t._v(" "),s("code",[t._v("kubelet")]),t._v(" "),s("code",[t._v("kubectl")]),t._v(" , "),s("code",[t._v("kubelet")]),t._v("设为自启动")]),t._v(" "),s("li",[s("code",[t._v("kubeadm")]),t._v(" 初始化"),s("code",[t._v("control-plane")]),t._v(" "),s("code",[t._v("etcd")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubeadm config print init-defaults "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" k8s.yaml\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta2\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bootstrapTokens")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("groups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" system"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("bootstrappers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kubeadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" abcdef.0123456789abcdef\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 24h0m0s\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("usages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" signing\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" authentication\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" InitConfiguration\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localAPIEndpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("advertiseAddress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.100.80\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeRegistration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("criSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/run/dockershim.sock\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("taints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role.kubernetes.io/master\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeoutForControlPlane")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4m0s\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta2\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("certificatesDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kubernetes/pki\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("controllerManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CoreDNS\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("etcd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/etcd\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s.gcr.io\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterConfiguration\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetesVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1.20.0\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networking")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsDomain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster.local\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceSubnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.96.0.0/12\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSubnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.244.0.0/16\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scheduler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("下载必要的组件")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubeadm config images list --config ./k8s.yaml\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# k8s.gcr.io/kube-apiserver:v1.20.0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# k8s.gcr.io/kube-controller-manager:v1.20.0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# k8s.gcr.io/kube-scheduler:v1.20.0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# k8s.gcr.io/kube-proxy:v1.20.0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# k8s.gcr.io/pause:3.2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# k8s.gcr.io/etcd:3.4.13-0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# k8s.gcr.io/coredns:1.7.0")]),t._v("\n\n\nkubeadm config images pull --config ./k8s.yaml\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("初始化"),s("code",[t._v("control-plane")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubeadm init --config ./k8s.yaml\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  其他节点最后加入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubeadm "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".100.80:6443 --token abcdef.0123456789abcdef "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --discovery-token-ca-cert-hash sha256:8a8e18afb8aaa05d35305bd7d65e50542d5673032fcb0988089a298fe330cea3\n\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("环境变量")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 非 root 用户使 `kubectl` 命令   admin.conf从control-plane节点同步到其它worker节点")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# root用户")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("KUBECONFIG")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/admin.conf\n\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("集群 pod 网关通信组件")])]),t._v(" "),s("blockquote",[s("p",[t._v("第三方有多种实现")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/coreos/flannel",target:"_blank",rel:"noopener noreferrer"}},[t._v("flannel"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群主节点执行即可")]),t._v("\nkubectl apply -f flannel.yaml  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像需要拉取")]),t._v("\n")])])]),s("h2",{attrs:{id:"dashboard"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dashboard"}},[t._v("#")]),t._v(" dashboard")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/kubernetes/dashboard/",target:"_blank",rel:"noopener noreferrer"}},[t._v("dashboard"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# port需要开放")]),t._v("\nkubectl edit services kubernetes-dashboard -n kubernetes-dashboard\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# type: NodePort")]),t._v("\n")])])]),s("h2",{attrs:{id:"高可用集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#高可用集群"}},[t._v("#")]),t._v(" 高可用集群")]),t._v(" "),s("p",[t._v("上云吧")])])}),[],!1,null,null,null);a.default=n.exports}}]);